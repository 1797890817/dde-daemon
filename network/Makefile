GEN_NM_ENUM_TPL = nm_enum_gen.go.tpl
GEN_NM_ENUM_FILE = nm_enum_gen.go
GEN_NM_SETTING_KEY_FILE = nm_setting_key_gen.go

all:
	@echo need make target

gen-nm-enum:
	@sed '/NM_SECRET_AGENT_CAPABILITY_LAST =/d' /usr/include/libnm/nm-dbus-interface.h > /tmp/nm-dbus-interface.h
	@glib-mkenums --template $(GEN_NM_ENUM_TPL) /usr/include/libnm/nm-vpn-dbus-interface.h /usr/include/libnm/nm-setting.h /tmp/nm-dbus-interface.h > $(GEN_NM_ENUM_FILE)
	@gofmt -w $(GEN_NM_ENUM_FILE)

gen-nm-setting-key:
	@echo "// This file is automatically generated, please don't edit manually." > $(GEN_NM_SETTING_KEY_FILE)
	@echo -e "package network\n" >> $(GEN_NM_SETTING_KEY_FILE)
	@for f in /usr/include/libnm/nm-setting-*.h; do \
		echo "// $$f"; \
		echo "const ("; \
		grep '^#define.*".*"' $$f | awk '{print $$2,"=",$$3}'; \
		echo -e ")\n"; \
		done >> $(GEN_NM_SETTING_KEY_FILE)
	@gofmt -w $(GEN_NM_SETTING_KEY_FILE)
