GEN_NM_ENUMS_TPL = nm_enums_gen.go.tpl
GEN_NM_ENUMS_FILE = nm_enums_gen.go
GEN_NM_SETTING_KEYS_FILE = nm_setting_keys_gen.go

all: gen-nm-enum
	@echo need make target

gen-nm-enums:
	@headers=(); for f in /usr/include/libnm/*.h; do \
		if grep -q 'NM_\w*_LAST *=' $$f; then \
			sed '/NM_\w*_LAST *=/d' $$f > /tmp/`basename $$f`; \
			headers+=(/tmp/`basename $$f`); \
		else \
			headers+=($$f); \
		fi; \
		done; glib-mkenums --template $(GEN_NM_ENUMS_TPL) $${headers[@]} > $(GEN_NM_ENUMS_FILE)
	@gofmt -w $(GEN_NM_ENUMS_FILE)

gen-nm-setting-keys:
	@echo "// This file is automatically generated, please don't edit manually." > $(GEN_NM_SETTING_KEYS_FILE)
	@echo -e "package network\n" >> $(GEN_NM_SETTING_KEYS_FILE)
	@for f in /usr/include/libnm/nm-setting*.h; do \
		echo "// $$f"; \
		echo "const ("; \
		grep '^#define.*".*"' $$f | awk '{print $$2,"=",$$3}'; \
		echo -e ")\n"; \
		done >> $(GEN_NM_SETTING_KEYS_FILE)
	@gofmt -w $(GEN_NM_SETTING_KEYS_FILE)
